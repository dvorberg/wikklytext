#!/usr/bin/env python

import sys, time, argparse, pathlib

from wikklytext import to_html

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("--outfile", "-o",
                        nargs='?', type=argparse.FileType('w'),
                        default=sys.stdout)
    parser.add_argument("infilepath", type=pathlib.Path)
    args = parser.parse_args()

    with args.infilepath.open() as fp:
        wikkly = fp.read()

    print('<!DOCTYPE html>',
          '<html>',
          '<head>',
          '<title></title>',
          '<meta charset="utf-8">',
          '</head>',
          '<body>',
          sep="\n", file=args.outfile)
    parse_start = time.time()
    html = to_html(wikkly)
    parse_end = time.time()

    print(html, file=args.outfile)
    print('</body>', '</html>', sep="\n", file=args.outfile)

    print("Conversion time: %.4f sec" % (parse_end-parse_start,),
          file=sys.stderr)


main()
