#!/usr/bin/env python

import sys, time, argparse, pathlib

from wikklytext.to_html import WikklyToHTML

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("--outfile", "-o",
                        nargs='?', type=argparse.FileType('w'),
                        default=sys.stdout)
    parser.add_argument("infilepath", type=pathlib.Path)
    args = parser.parse_args()

    wcontext = None
    converter = WikklyToHTML(wcontext)

    with args.infilepath.open() as fp:
        wikkly = fp.read()
        parse_start = time.time()
        converter.parse(wikkly)

    print('<!DOCTYPE html>',
          '<html>',
          '<head>',
          '<meta charset="utf-8">',
          '</head>',
          '<body>',
          sep="\n", file=args.outfile)
    print(converter.get_html(), file=args.outfile)
    parse_end = time.time()
    print('</body>', '</html>', sep="\n", file=args.outfile)

    print("Conversion time: %.4f sec" % (parse_end-parse_start,),
          file=sys.stderr)


main()
